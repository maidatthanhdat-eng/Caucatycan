<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Câu Cá Tỷ Cân - No Collision</title>
<style>
body{margin:0;overflow:hidden;}
#viewport{width:100vw;height:100vh;overflow:hidden;position:relative;background:#000;}
#game{width:612px;height:193px;position:absolute;top:0;left:0;background:url('map1.png') no-repeat;background-size:cover;}
#player{width:50px;height:50px;position:absolute;background:url('santachuoibi.jpg') center/cover no-repeat;pointer-events:none;}
.snow{position:absolute;width:6px;height:6px;background:white;border-radius:50%;opacity:0.9;pointer-events:none;}
</style>
</head>
<body>
<div id="viewport">
  <div id="game">
    <div id="player"></div>
  </div>
</div>

<script>
const game=document.getElementById("game");
const viewport=document.getElementById("viewport");
const player=document.getElementById("player");

const mapWidth=612,mapHeight=193;
const playerW=50,playerH=50;
const speed=5;
let pos={x:20,y:mapHeight-playerH-10}; // spawn dưới bên trái
let keys={w:false,a:false,s:false,d:false};

/* INPUT */
document.addEventListener("keydown",e=>{const k=e.key.toLowerCase(); if(k in keys) keys[k]=true;});
document.addEventListener("keyup",e=>{const k=e.key.toLowerCase(); if(k in keys) keys[k]=false;});

/* TUYẾT */
const snowLayer=document.createElement("div");
snowLayer.style.position="absolute";
snowLayer.style.width=mapWidth+"px";
snowLayer.style.height=mapHeight+"px";
snowLayer.style.pointerEvents="none";
game.appendChild(snowLayer);

const snows=[];
function createSnow(){
  const s=document.createElement("div");
  s.className="snow";
  s.style.left=Math.random()*mapWidth+"px";
  s.style.top="-10px";
  s.speedY=5+Math.random()*5;
  s.speedX=1+Math.random()*2;
  snowLayer.appendChild(s);
  snows.push(s);
}
function updateSnow(){
  if(snows.length<50) createSnow();
  for(let i=snows.length-1;i>=0;i--){
    const s=snows[i];
    s.style.top=(s.offsetTop+s.speedY)+"px";
    s.style.left=(s.offsetLeft+s.speedX)+"px";
    if(s.offsetTop>mapHeight||s.offsetLeft>mapWidth){ s.remove(); snows.splice(i,1);}
  }
}

/* GAME LOOP */
function update(){
  let moveX=0, moveY=0;
  if(keys.w) moveY-=speed;
  if(keys.s) moveY+=speed;
  if(keys.a) moveX-=speed;
  if(keys.d) moveX+=speed;

  pos.x+=moveX;
  pos.y+=moveY;

  // giới hạn trong map
  pos.x=Math.max(0,Math.min(pos.x,mapWidth-playerW));
  pos.y=Math.max(0,Math.min(pos.y,mapHeight-playerH));

  // camera follow
  let camX=pos.x-viewport.offsetWidth/2+playerW/2;
  let camY=pos.y-viewport.offsetHeight/2+playerH/2;
  camX=Math.max(0,Math.min(camX,mapWidth-viewport.offsetWidth));
  camY=Math.max(0,Math.min(camY,mapHeight-viewport.offsetHeight));

  game.style.transform=`translate(${-camX}px,${-camY}px)`;
  player.style.left=(pos.x-camX)+"px";
  player.style.top=(pos.y-camY)+"px";

  updateSnow();
  requestAnimationFrame(update);
}

update();
</script>
</body>
</html>


