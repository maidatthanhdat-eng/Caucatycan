<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Câu Cá Vạn Cân</title>
<style>
  body { margin:0; padding:0; overflow:hidden; font-family:Arial,sans-serif; background-color:#87CEFA; }
  h1 { color:white; font-size:48px; text-align:center; margin-top:50px; text-shadow:2px 2px #000; }
  #startButton { position:fixed; bottom:20px; right:20px; font-size:36px; padding:20px 60px; border-radius:15px; background-color:orange; color:white; cursor:pointer; box-shadow:3px 3px #555; }
  #startButton:hover { background-color:#ff9900; }
  #gameCanvas { display:none; background-color:#ADD8E6; position:absolute; top:0; left:0; }
  #fishButton { position:fixed; bottom:20px; right:20px; font-size:32px; padding:20px 40px; border-radius:15px; background-color:#00AAFF; color:white; box-shadow:2px 2px #555; cursor:pointer; display:none; }
  #fishButton:hover { background-color:#0099DD; }
</style>
</head>
<body>
<h1>Câu Cá Vạn Cân</h1>
<button id="startButton">Đi câu cá</button>
<canvas id="gameCanvas"></canvas>
<button id="fishButton">Thả cần</button>

<script>
const startButton = document.getElementById("startButton");
const fishButton = document.getElementById("fishButton");
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x:0, y:0, width:40, height:40, speed:5, hasRod:true };
let playerXP = 50;
let playerLevel = 3;
let playerStamina = 70;
let keys = {};
let rodImage = new Image();
rodImage.src = "https://i.imgur.com/Q7jX4x1.png"; // link ảnh cần câu
let fishing = false; // trạng thái thả cần
let lineLength = 0; // độ dài dây câu

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  if(player.x ===0 && player.y===0){
    player.x = canvas.width/2;
    player.y = canvas.height/2;
  }
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

startButton.addEventListener("click", () => {
  document.querySelector("h1").style.display="none";
  startButton.style.display="none";
  canvas.style.display="block";
  fishButton.style.display="block";
  gameLoop();
});

fishButton.addEventListener("click", () => {
  if(playerStamina >=10 && player.hasRod){
    playerStamina -=10;
    playerXP +=5;
    if(playerXP>100) playerXP=100;
    fishing = true;
    lineLength = 0;
    // tạm thời bỏ phím di chuyển
    keys["w"]=false; keys["a"]=false; keys["s"]=false; keys["d"]=false;
    keys["ArrowUp"]=false; keys["ArrowLeft"]=false; keys["ArrowDown"]=false; keys["ArrowRight"]=false;
  } else {
    alert("Không đủ thể lực hoặc không có cần câu!");
  }
});

function drawPlayer(){
  ctx.fillStyle="red";
  ctx.fillRect(player.x, player.y, player.width, player.height);
  if(player.hasRod){
    // vẽ cần câu trên tay nhân vật
    ctx.drawImage(rodImage, player.x + player.width/2 -10, player.y - rodImage.height/2, 20, 40);
  }
}

let lastDirection = "right"; // mặc định phải

window.addEventListener("keydown", e => {
  keys[e.key] = true;

  // chỉ cập nhật hướng trái/phải
  if(e.key === "a" || e.key === "ArrowLeft") lastDirection = "left";
  if(e.key === "d" || e.key === "ArrowRight") lastDirection = "right";
});

window.addEventListener("keyup", e => { keys[e.key] = false; });

function updatePlayer(){
  // chỉ di chuyển ngang
  if(keys["ArrowLeft"] || keys["a"]) player.x -= player.speed;
  if(keys["ArrowRight"] || keys["d"]) player.x += player.speed;

  // Giữ trong màn hình
  if(player.x < 0) player.x = 0;
  if(player.x + player.width > canvas.width) player.x = canvas.width - player.width;
}

function drawFishingLine(){
  if(fishing){
    if(lineLength < canvas.height - player.y - player.height){
      lineLength +=5; // tốc độ dây câu thả xuống
    }

    let startX = player.x + player.width/2;
    let startY = player.y + player.height/2;
    let endX = startX + (lastDirection === "left" ? -50 : 50); // thả bên trái/phải
    let endY = startY + lineLength;

    ctx.strokeStyle = "black";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    ctx.lineTo(endX, endY);
    ctx.stroke();
  }
}

// Thay đổi fishButton để không reset keys, vẫn cho di chuyển
fishButton.addEventListener("click", () => {
  if(playerStamina >=10 && player.hasRod){
    playerStamina -=10;
    playerXP +=5;
    if(playerXP>100) playerXP=100;
    fishing = true;
    lineLength = 0;
    // không reset keys để vẫn di chuyển bình thường
  } else {
    alert("Không đủ thể lực hoặc không có cần câu!");
  }
});

function drawHUD(){
  ctx.fillStyle="green";
  ctx.fillRect(20,20,2*playerXP,30);
  ctx.strokeStyle="white";
  ctx.strokeRect(20,20,200,30);
  ctx.fillStyle="white";
  ctx.font="16px Arial";
  ctx.fillText("Lv "+playerLevel,230,42);

  ctx.fillStyle="yellow";
  ctx.fillRect(20,60,2*playerStamina,20);
  ctx.strokeStyle="white";
  ctx.strokeRect(20,60,200,20);
  ctx.fillStyle="white";
  ctx.font="14px Arial";
  ctx.fillText("Thể lực",230,75);
}

function drawFishingLine(){
  if(fishing){
    if(lineLength < canvas.height - player.y - player.height){
      lineLength +=5; // tốc độ dây câu thả xuống
    }
    ctx.strokeStyle="black";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(player.x + player.width/2, player.y + player.height/2);
    ctx.lineTo(player.x + player.width/2, player.y + player.height/2 + lineLength);
    ctx.stroke();
  }
}

function gameLoop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  updatePlayer();
  drawPlayer();
  drawHUD();
  drawFishingLine();
  requestAnimationFrame(gameLoop);
}

// HUD menu
function drawMenuHUD(){
  const tempCanvas=document.createElement("canvas");
  const tempCtx=tempCanvas.getContext("2d");
  tempCanvas.width=window.innerWidth;
  tempCanvas.height=window.innerHeight;
  document.body.appendChild(tempCanvas);
  tempCanvas.style.position="fixed";
  tempCanvas.style.top="0";
  tempCanvas.style.left="0";
  tempCanvas.style.pointerEvents="none";

  function draw(){
    tempCtx.clearRect(0,0,tempCanvas.width,tempCanvas.height);
    // XP
    tempCtx.fillStyle="green";
    tempCtx.fillRect(20,20,2*playerXP,30);
    tempCtx.strokeStyle="white";
    tempCtx.strokeRect(20,20,200,30);
    tempCtx.fillStyle="white";
    tempCtx.font="16px Arial";
    tempCtx.fillText("Lv "+playerLevel,230,42);

    // Stamina
    tempCtx.fillStyle="yellow";
    tempCtx.fillRect(20,60,2*playerStamina,20);
    tempCtx.strokeStyle="white";
    tempCtx.strokeRect(20,60,200,20);
    tempCtx.fillStyle="white";
    tempCtx.font="14px Arial";
    tempCtx.fillText("Thể lực",230,75);

    requestAnimationFrame(draw);
  }
  draw();
}

drawMenuHUD();
</script>
</body>
</html>
